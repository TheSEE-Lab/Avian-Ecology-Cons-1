<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>eBird Yucatan Practical</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="ebird_yucatan_practical_files/libs/clipboard/clipboard.min.js"></script>
<script src="ebird_yucatan_practical_files/libs/quarto-html/quarto.js"></script>
<script src="ebird_yucatan_practical_files/libs/quarto-html/popper.min.js"></script>
<script src="ebird_yucatan_practical_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ebird_yucatan_practical_files/libs/quarto-html/anchor.min.js"></script>
<link href="ebird_yucatan_practical_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ebird_yucatan_practical_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ebird_yucatan_practical_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ebird_yucatan_practical_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ebird_yucatan_practical_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link" data-scroll-target="#getting-started">0. Getting started</a>
  <ul class="collapse">
  <li><a href="#set-your-working-directory" id="toc-set-your-working-directory" class="nav-link" data-scroll-target="#set-your-working-directory">0.1. Set your working directory</a></li>
  </ul></li>
  <li><a href="#a.-initial-data-exploration-with-microsoft-excel" id="toc-a.-initial-data-exploration-with-microsoft-excel" class="nav-link" data-scroll-target="#a.-initial-data-exploration-with-microsoft-excel">0A. Initial data exploration with Microsoft Excel</a>
  <ul class="collapse">
  <li><a href="#exercise-0a.1-exploring-the-checklist-data" id="toc-exercise-0a.1-exploring-the-checklist-data" class="nav-link" data-scroll-target="#exercise-0a.1-exploring-the-checklist-data">Exercise 0A.1: Exploring the checklist data</a></li>
  <li><a href="#exercise-0a.2-exploring-the-species-detection-data" id="toc-exercise-0a.2-exploring-the-species-detection-data" class="nav-link" data-scroll-target="#exercise-0a.2-exploring-the-species-detection-data">Exercise 0A.2: Exploring the species detection data</a></li>
  <li><a href="#exercise-0a.3-exploring-the-trait-data" id="toc-exercise-0a.3-exploring-the-trait-data" class="nav-link" data-scroll-target="#exercise-0a.3-exploring-the-trait-data">Exercise 0A.3: Exploring the trait data</a></li>
  <li><a href="#exercise-0a.4-linking-datasets-challenge---for-homework" id="toc-exercise-0a.4-linking-datasets-challenge---for-homework" class="nav-link" data-scroll-target="#exercise-0a.4-linking-datasets-challenge---for-homework">Exercise 0A.4: Linking datasets (challenge - for homework)</a></li>
  <li><a href="#load-required-packages" id="toc-load-required-packages" class="nav-link" data-scroll-target="#load-required-packages">0.2. Load required packages</a></li>
  <li><a href="#load-the-datasets-in-r" id="toc-load-the-datasets-in-r" class="nav-link" data-scroll-target="#load-the-datasets-in-r">0.3. Load the datasets in R</a></li>
  </ul></li>
  <li><a href="#mapping-yucatan-peninsula-checklists-and-richness" id="toc-mapping-yucatan-peninsula-checklists-and-richness" class="nav-link" data-scroll-target="#mapping-yucatan-peninsula-checklists-and-richness">1. Mapping Yucatan Peninsula checklists and richness</a>
  <ul class="collapse">
  <li><a href="#regional-boundary-and-checklist-locations" id="toc-regional-boundary-and-checklist-locations" class="nav-link" data-scroll-target="#regional-boundary-and-checklist-locations">1.1. Regional boundary and checklist locations</a></li>
  <li><a href="#species-richness-per-checklist" id="toc-species-richness-per-checklist" class="nav-link" data-scroll-target="#species-richness-per-checklist">1.2. Species richness per checklist</a></li>
  <li><a href="#spatial-density-mapping-sampling-effort-and-species-abundance" id="toc-spatial-density-mapping-sampling-effort-and-species-abundance" class="nav-link" data-scroll-target="#spatial-density-mapping-sampling-effort-and-species-abundance">1.3. Spatial density mapping: sampling effort and species abundance</a>
  <ul class="collapse">
  <li><a href="#sampling-effort-density" id="toc-sampling-effort-density" class="nav-link" data-scroll-target="#sampling-effort-density">1.3.1. Sampling effort density</a></li>
  <li><a href="#species-abundance-density" id="toc-species-abundance-density" class="nav-link" data-scroll-target="#species-abundance-density">1.3.2. Species abundance density</a></li>
  <li><a href="#weighted-abundance-density" id="toc-weighted-abundance-density" class="nav-link" data-scroll-target="#weighted-abundance-density">1.3.3. Weighted abundance density</a></li>
  <li><a href="#hexagonal-binning-for-abundance-extrapolation" id="toc-hexagonal-binning-for-abundance-extrapolation" class="nav-link" data-scroll-target="#hexagonal-binning-for-abundance-extrapolation">1.3.4. Hexagonal binning for abundance extrapolation</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#species-trends-reporting-rates-over-time" id="toc-species-trends-reporting-rates-over-time" class="nav-link" data-scroll-target="#species-trends-reporting-rates-over-time">2. Species trends: reporting rates over time</a>
  <ul class="collapse">
  <li><a href="#prepare-annual-reporting-data" id="toc-prepare-annual-reporting-data" class="nav-link" data-scroll-target="#prepare-annual-reporting-data">2.1. Prepare annual reporting data</a></li>
  <li><a href="#plot-reporting-rate-trends" id="toc-plot-reporting-rate-trends" class="nav-link" data-scroll-target="#plot-reporting-rate-trends">2.2. Plot reporting rate trends</a></li>
  </ul></li>
  <li><a href="#land-cover-comparison-community-composition" id="toc-land-cover-comparison-community-composition" class="nav-link" data-scroll-target="#land-cover-comparison-community-composition">3. Land cover comparison: community composition</a>
  <ul class="collapse">
  <li><a href="#species-by-land-cover-table" id="toc-species-by-land-cover-table" class="nav-link" data-scroll-target="#species-by-land-cover-table">3.1. Species-by-land-cover table</a></li>
  <li><a href="#most-frequently-detected-species-per-land-cover" id="toc-most-frequently-detected-species-per-land-cover" class="nav-link" data-scroll-target="#most-frequently-detected-species-per-land-cover">3.2. Most frequently detected species per land cover</a></li>
  </ul></li>
  <li><a href="#functional-diversity-by-land-cover" id="toc-functional-diversity-by-land-cover" class="nav-link" data-scroll-target="#functional-diversity-by-land-cover">4. Functional diversity by land cover</a>
  <ul class="collapse">
  <li><a href="#trait-matrix-for-species" id="toc-trait-matrix-for-species" class="nav-link" data-scroll-target="#trait-matrix-for-species">4.1. Trait matrix for species</a></li>
  <li><a href="#species-relative-abundance-by-land-cover" id="toc-species-relative-abundance-by-land-cover" class="nav-link" data-scroll-target="#species-relative-abundance-by-land-cover">4.2. Species relative abundance by land cover</a></li>
  <li><a href="#compute-functional-diversity-indices" id="toc-compute-functional-diversity-indices" class="nav-link" data-scroll-target="#compute-functional-diversity-indices">4.3. Compute functional diversity indices</a></li>
  <li><a href="#visualising-functional-diversity-differences" id="toc-visualising-functional-diversity-differences" class="nav-link" data-scroll-target="#visualising-functional-diversity-differences">4.4. Visualising functional diversity differences</a></li>
  </ul></li>
  <li><a href="#trait-distributions-in-different-land-cover-types" id="toc-trait-distributions-in-different-land-cover-types" class="nav-link" data-scroll-target="#trait-distributions-in-different-land-cover-types">5. Trait distributions in different land cover types</a>
  <ul class="collapse">
  <li><a href="#trait-distributions-weighted-by-abundance" id="toc-trait-distributions-weighted-by-abundance" class="nav-link" data-scroll-target="#trait-distributions-weighted-by-abundance">5.1. Trait distributions weighted by abundance</a></li>
  </ul></li>
  <li><a href="#optional-extension-pca-of-traits" id="toc-optional-extension-pca-of-traits" class="nav-link" data-scroll-target="#optional-extension-pca-of-traits">6. Optional extension: PCA of traits</a></li>
  <li><a href="#wrap-up-questions" id="toc-wrap-up-questions" class="nav-link" data-scroll-target="#wrap-up-questions">7. Wrap-up questions</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">eBird Yucatan Practical</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="overview" class="level1">
<h1>Overview</h1>
<p>You will work with three small teaching datasets supplied with this practical:</p>
<ul>
<li><code>ebird_yucatan_checklists.csv</code> – checklist-level data (location, date, land cover, effort).</li>
<li><code>ebird_yucatan.csv</code> – species-level detections linked to checklists.</li>
<li><code>ebird_yucatan_traits.csv</code> – simple functional traits for a subset of Yucatan bird species.</li>
</ul>
<p>The workflow is <strong>loosely inspired</strong> by:</p>
<ul>
<li>Stewart et al.&nbsp;(2025) – threat abatement and conservation of global bird diversity.</li>
<li>Matthews et al.&nbsp;(2024) – global loss of avian functional and phylogenetic diversity.</li>
</ul>
<p>We will not reproduce the papers, but we will <strong>borrow their ideas</strong>: habitat loss, extinction risk, and functional diversity.</p>
</section>
<section id="getting-started" class="level1">
<h1>0. Getting started</h1>
<section id="set-your-working-directory" class="level2">
<h2 class="anchored" data-anchor-id="set-your-working-directory">0.1. Set your working directory</h2>
<p>Place all files in the same directory:</p>
<ul>
<li>this Quarto file: <code>ebird_yucatan_practical.qmd</code></li>
<li><code>ebird_yucatan_checklists.csv</code></li>
<li><code>ebird_yucatan.csv</code></li>
<li><code>ebird_yucatan_traits.csv</code></li>
</ul>
<p>Then set the working directory in R (only if needed):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># setwd("path/to/your/folder")  # &lt;- adjust and uncomment if necessary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="a.-initial-data-exploration-with-microsoft-excel" class="level1">
<h1>0A. Initial data exploration with Microsoft Excel</h1>
<p>Before diving into R, let’s get familiar with the datasets using Microsoft Excel (or LibreOffice Calc, Google Sheets, etc.). Open the three CSV files in your spreadsheet software.</p>
<section id="exercise-0a.1-exploring-the-checklist-data" class="level2">
<h2 class="anchored" data-anchor-id="exercise-0a.1-exploring-the-checklist-data">Exercise 0A.1: Exploring the checklist data</h2>
<p>Open <code>ebird_yucatan_checklists.csv</code> in Excel.</p>
<p><strong>Tasks:</strong></p>
<ol type="1">
<li><p><strong>Count rows</strong>: How many checklists are in the dataset?<br>
<em>Hint: Look at the row numbers or use <code>=COUNTA()</code> function.</em></p></li>
<li><p><strong>Examine columns</strong>: What variables are recorded for each checklist?<br>
List at least 5 column names.</p></li>
<li><p><strong>Date range</strong>: What are the earliest and latest observation dates?<br>
<em>Hint: Sort the <code>date</code> column or use <code>=MIN()</code> and <code>=MAX()</code> functions.</em></p></li>
<li><p><strong>Land cover types</strong>: How many different land cover categories are there?<br>
<em>Hint: Use a Pivot Table or filter the <code>land_cover</code> column to see unique values.</em></p></li>
<li><p><strong>Species richness</strong>: Create a simple histogram of <code>n_species</code> values.</p>
<ul>
<li>Select the <code>n_species</code> column</li>
<li>Insert → Chart → Histogram</li>
<li>What is the typical range of species per checklist?</li>
</ul></li>
<li><p><strong>Effort hours</strong>: What is the average effort in hours per checklist?<br>
<em>Hint: Use <code>=AVERAGE()</code> on the <code>effort_hours</code> column.</em></p></li>
</ol>
</section>
<section id="exercise-0a.2-exploring-the-species-detection-data" class="level2">
<h2 class="anchored" data-anchor-id="exercise-0a.2-exploring-the-species-detection-data">Exercise 0A.2: Exploring the species detection data</h2>
<p>Open <code>ebird_yucatan.csv</code> in Excel.</p>
<p><strong>Tasks:</strong></p>
<ol type="1">
<li><p><strong>Total observations</strong>: How many species detection records are there?</p></li>
<li><p><strong>Species diversity</strong>: How many unique species are in the dataset?<br>
<em>Hint: Copy the <code>scientific_name</code> column to a new sheet, then use Remove Duplicates (Data tab).</em></p></li>
<li><p><strong>Most common species</strong>: Use a Pivot Table to find the most frequently detected species:</p>
<ul>
<li>Create a Pivot Table with <code>scientific_name</code> in Rows</li>
<li>Add <code>checklist_ID</code> to Values (Count)</li>
<li>Sort by count descending</li>
<li>Which species appears in the most checklists?</li>
</ul></li>
<li><p><strong>Abundance patterns</strong>: What is the maximum count recorded for any species in a single checklist?<br>
<em>Hint: Use <code>=MAX()</code> on the <code>count</code> column.</em></p></li>
<li><p><strong>Link to checklists</strong>: Pick one <code>checklist_ID</code> value and see how many species were recorded on that checklist.<br>
<em>Hint: Use AutoFilter on the <code>checklist_ID</code> column.</em></p></li>
</ol>
</section>
<section id="exercise-0a.3-exploring-the-trait-data" class="level2">
<h2 class="anchored" data-anchor-id="exercise-0a.3-exploring-the-trait-data">Exercise 0A.3: Exploring the trait data</h2>
<p>Open <code>ebird_yucatan_traits.csv</code> in Excel.</p>
<p><strong>Tasks:</strong></p>
<ol type="1">
<li><p><strong>Trait coverage</strong>: How many species have trait data available?</p></li>
<li><p><strong>Body mass range</strong>: What are the smallest and largest body masses in the dataset?<br>
<em>Hint: Use <code>=MIN()</code> and <code>=MAX()</code> on <code>body_mass_g</code>.</em></p></li>
<li><p><strong>Trophic niches</strong>: What different trophic niche categories are present?<br>
<em>Hint: Filter or create a Pivot Table on <code>trophic_niche</code>.</em></p></li>
<li><p><strong>Trait relationships</strong>: Create a scatter plot of <code>body_mass_g</code> vs <code>wing_length</code>:</p>
<ul>
<li>Select both columns</li>
<li>Insert → Chart → Scatter plot</li>
<li>Do you see any relationship?</li>
</ul></li>
<li><p><strong>Beak dimensions</strong>: Which species has the longest beak (culmen)?<br>
<em>Hint: Sort by <code>beak_length_culmen</code> descending.</em></p></li>
</ol>
</section>
<section id="exercise-0a.4-linking-datasets-challenge---for-homework" class="level2">
<h2 class="anchored" data-anchor-id="exercise-0a.4-linking-datasets-challenge---for-homework">Exercise 0A.4: Linking datasets (challenge - for homework)</h2>
<p><strong>Tasks:</strong></p>
<ol type="1">
<li>Using Excel’s <code>VLOOKUP</code> or <code>XLOOKUP</code>, try to match species from the detection file to their traits:
<ul>
<li>In the detections file, add a new column for <code>body_mass_g</code></li>
<li>Use a lookup formula to fetch body mass from the traits file</li>
<li>Formula example: <code>=VLOOKUP(B2, traits!A:B, 2, FALSE)</code></li>
</ul></li>
<li>Calculate the average body mass of species detected in your first checklist.</li>
</ol>
<p><strong>Reflection questions:</strong></p>
<ul>
<li>What patterns did you notice in the data?</li>
<li>Which land cover type has the most sampling effort?</li>
<li>What are some challenges of working with these data in Excel?</li>
<li>What questions would be easier to answer with R?</li>
</ul>
</section>
<section id="load-required-packages" class="level2">
<h2 class="anchored" data-anchor-id="load-required-packages">0.2. Load required packages</h2>
<p>We will use only widely available R packages. First - install, manually, the <code>pacman</code> package if needed.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pacman)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    tidyverse, sf, rnaturalearth,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    rnaturalearthdata, FD,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    ggrepel, textshape</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="load-the-datasets-in-r" class="level2">
<h2 class="anchored" data-anchor-id="load-the-datasets-in-r">0.3. Load the datasets in R</h2>
<p>Now we’ll load the same datasets into R for more sophisticated analysis.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>checklists <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"ebird_yucatan_checklists.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 37912 Columns: 11
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (3): checklist_ID, observer_ID, land_cover
dbl  (7): year, month, latitude, longitude, effort_hours, n_species, land_co...
date (1): date

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>detections <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"ebird_yucatan.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 727110 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (4): checklist_ID, species_code, scientific_name, common_name
dbl (1): count

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>traits     <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"ebird_yucatan_traits.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 728 Columns: 8
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): species_code, scientific_name, trophic_niche
dbl (5): body_mass_g, beak_length_culmen, beak_length_nares, beak_width, win...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(checklists)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 37,912
Columns: 11
$ checklist_ID    &lt;chr&gt; "S16159516", "S16160400", "S16160982", "S16164120", "S…
$ date            &lt;date&gt; 2014-01-01, 2014-01-01, 2014-01-01, 2014-01-01, 2014-…
$ year            &lt;dbl&gt; 2014, 2014, 2014, 2014, 2014, 2014, 2014, 2014, 2014, …
$ month           &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ latitude        &lt;dbl&gt; 16.09476, 20.98580, 20.08957, 21.33032, 18.98941, 14.3…
$ longitude       &lt;dbl&gt; -88.83536, -87.21359, -89.54980, -86.92383, -86.02844,…
$ effort_hours    &lt;dbl&gt; 9.6666667, 3.0000000, 0.4666667, 1.5000000, 0.5000000,…
$ observer_ID     &lt;chr&gt; "obsr246930", "obsr411187", "obsr174363", "obsr411187"…
$ n_species       &lt;dbl&gt; 41, 83, 12, 15, 11, 8, 18, 14, 33, 1, 13, 5, 66, 32, 5…
$ land_cover_code &lt;dbl&gt; 10, 30, 10, 10, NA, 10, 10, 10, 10, 10, 30, 50, 10, 10…
$ land_cover      &lt;chr&gt; "forest", "grassland", "forest", "forest", "other", "f…</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(detections)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 727,110
Columns: 5
$ checklist_ID    &lt;chr&gt; "S17908640", "S16466102", "S17697809", "S17110903", "S…
$ species_code    &lt;chr&gt; "paltyr2", "ameavo", "blarob1", "oliwoo1", "brnpel", "…
$ scientific_name &lt;chr&gt; "Zimmerius vilissimus", "Recurvirostra americana", "Tu…
$ common_name     &lt;chr&gt; "Guatemalan Tyrannulet", "American Avocet", "Black Thr…
$ count           &lt;dbl&gt; 4, 210, 1, 1, 30, 2, 50, 6, 1, 1, 2, 4, 3, 10, 1, 1, 4…</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(traits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 728
Columns: 8
$ species_code       &lt;chr&gt; NA, NA, "shshaw", "blchaw1", "zothaw", "shthaw", "r…
$ scientific_name    &lt;chr&gt; "Accipiter bicolor", "Accipiter cooperii", "Accipit…
$ body_mass_g        &lt;dbl&gt; 287.5, 429.7, 130.6, 766.1, 745.9, 496.0, 1101.2, 5…
$ beak_length_culmen &lt;dbl&gt; 25.0, 25.4, 18.3, 40.8, 35.1, 31.1, 37.6, 34.1, 28.…
$ beak_length_nares  &lt;dbl&gt; 13.7, 13.9, 10.1, 27.1, 21.1, 17.0, 22.9, 20.9, 17.…
$ beak_width         &lt;dbl&gt; 8.6, 8.6, 7.3, 12.5, 12.7, 10.4, 14.4, 11.4, 11.1, …
$ wing_length        &lt;dbl&gt; 229.6, 241.2, 181.6, 393.5, 398.0, 307.6, 402.8, 26…
$ trophic_niche      &lt;chr&gt; "Vertivore", "Vertivore", "Vertivore", "Aquatic pre…</code></pre>
</div>
</div>
<p><strong>Task 0.1 (students)</strong></p>
<ol type="1">
<li>How many checklists are there in the dataset? Compare with your Excel count.</li>
<li>Over which years do we have data?</li>
<li>Which land cover types are represented?</li>
</ol>
</section>
</section>
<section id="mapping-yucatan-peninsula-checklists-and-richness" class="level1">
<h1>1. Mapping Yucatan Peninsula checklists and richness</h1>
<p>In this part, we will:</p>
<ol type="1">
<li>Plot all checklists on a map of the Yucatan Peninsula region.</li>
<li>Compute basic species richness per checklist.</li>
<li>Visualise spatial variation in richness.</li>
</ol>
<section id="regional-boundary-and-checklist-locations" class="level2">
<h2 class="anchored" data-anchor-id="regional-boundary-and-checklist-locations">1.1. Regional boundary and checklist locations</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get Yucatan Peninsula + surrounding regions boundaries</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>mx_states <span class="ot">&lt;-</span> rnaturalearth<span class="sc">::</span><span class="fu">ne_states</span>(<span class="at">country =</span> <span class="st">"Mexico"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Yucatán"</span>, <span class="st">"Campeche"</span>, <span class="st">"Quintana Roo"</span>, <span class="st">"Tabasco"</span>, <span class="st">"Chiapas"</span>))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>belize <span class="ot">&lt;-</span> rnaturalearth<span class="sc">::</span><span class="fu">ne_countries</span>(<span class="at">country =</span> <span class="st">"Belize"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>guatemala <span class="ot">&lt;-</span> rnaturalearth<span class="sc">::</span><span class="fu">ne_countries</span>(<span class="at">country =</span> <span class="st">"Guatemala"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>checklists_sf <span class="ot">&lt;-</span> checklists <span class="sc">|&gt;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>,<span class="st">"latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mx_states, <span class="at">fill =</span> <span class="st">"grey95"</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> belize, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> guatemala, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> checklists_sf, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"eBird-style checklists in Yucatan Peninsula region"</span>,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ebird_yucatan_practical_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Task 1.1</strong></p>
<ul>
<li>Which parts of the Yucatan Peninsula are sampled most densely?</li>
<li>Do some land cover types seem under-sampled? (Use the code below to colour by land cover.)</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mx_states, <span class="at">fill =</span> <span class="st">"grey95"</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> belize, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> guatemala, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> checklists_sf, <span class="fu">aes</span>(<span class="at">color =</span> land_cover), <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Checklists by land cover type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ebird_yucatan_practical_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="species-richness-per-checklist" class="level2">
<h2 class="anchored" data-anchor-id="species-richness-per-checklist">1.2. Species richness per checklist</h2>
<p>The checklist data already include <code>n_species</code> (number of distinct species recorded). We can visualise how richness varies spatially.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mx_states, <span class="at">fill =</span> <span class="st">"grey95"</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> belize, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> guatemala, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> checklists_sf, <span class="fu">aes</span>(<span class="at">color =</span> n_species), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Species richness per checklist"</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Richness"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ebird_yucatan_practical_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Task 1.2</strong></p>
<ol type="1">
<li>Which land cover types have the highest average species richness?</li>
<li>Use the code below to summarise richness by land cover and interpret the result.</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>checklists <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(land_cover) <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_richness =</span> <span class="fu">mean</span>(n_species),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_richness   =</span> <span class="fu">sd</span>(n_species),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_checklists  =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  land_cover  mean_richness sd_richness n_checklists
  &lt;chr&gt;               &lt;dbl&gt;       &lt;dbl&gt;        &lt;int&gt;
1 agriculture          12.9        11.6          172
2 forest               20.3        22.3        22271
3 grassland            19.7        20.4         5996
4 other                16.2        15.7         2107
5 urban                15.2        15.7         6007
6 wetland              21.8        20.4         1359</code></pre>
</div>
</div>
</section>
<section id="spatial-density-mapping-sampling-effort-and-species-abundance" class="level2">
<h2 class="anchored" data-anchor-id="spatial-density-mapping-sampling-effort-and-species-abundance">1.3. Spatial density mapping: sampling effort and species abundance</h2>
<p>To better understand spatial patterns in eBird data, we can create <strong>density maps</strong> using kernel density estimation. This is useful for:</p>
<ol type="1">
<li>Visualising <strong>sampling effort</strong> (where are checklists concentrated?)</li>
<li>Mapping <strong>species abundance</strong> (where are particular species most abundant?)</li>
</ol>
<p>We will use the <code>ggplot2::stat_density_2d()</code> function to create smooth density surfaces.</p>
<section id="sampling-effort-density" class="level3">
<h3 class="anchored" data-anchor-id="sampling-effort-density">1.3.1. Sampling effort density</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a bounding box for the region</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>region_bbox <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">92</span>, <span class="at">xmax =</span> <span class="sc">-</span><span class="dv">86</span>, <span class="at">ymin =</span> <span class="dv">15</span>, <span class="at">ymax =</span> <span class="dv">22</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mx_states, <span class="at">fill =</span> <span class="st">"grey95"</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> belize, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> guatemala, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density_2d</span>(<span class="at">data =</span> checklists, </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">fill =</span> <span class="fu">after_stat</span>(level)),</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">geom =</span> <span class="st">"polygon"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">bins =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"magma"</span>) <span class="sc">+</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">92</span>, <span class="sc">-</span><span class="dv">86</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">22</span>)) <span class="sc">+</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"eBird sampling effort density"</span>,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Kernel density estimation of checklist locations"</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Density"</span>,</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ebird_yucatan_practical_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="species-abundance-density" class="level3">
<h3 class="anchored" data-anchor-id="species-abundance-density">1.3.2. Species abundance density</h3>
<p>Now let’s map the spatial density of a particular species. We’ll select a common species and map where it’s most frequently detected.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose a common species (adjust species_code as needed)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>focal_species <span class="ot">&lt;-</span> <span class="st">"yebsap"</span>  <span class="co"># Yellow-bellied Sapsucker as example</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get detections with location data</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>species_detections <span class="ot">&lt;-</span> detections <span class="sc">|&gt;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species_code <span class="sc">==</span> focal_species) <span class="sc">|&gt;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(checklists <span class="sc">|&gt;</span> <span class="fu">select</span>(checklist_ID, longitude, latitude), </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"checklist_ID"</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot species abundance density</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mx_states, <span class="at">fill =</span> <span class="st">"grey95"</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> belize, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> guatemala, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density_2d</span>(<span class="at">data =</span> species_detections,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">fill =</span> <span class="fu">after_stat</span>(level)),</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">geom =</span> <span class="st">"polygon"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">bins =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">92</span>, <span class="sc">-</span><span class="dv">86</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">22</span>)) <span class="sc">+</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Abundance density:"</span>, focal_species),</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Kernel density of species detections"</span>,</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Density"</span>,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ebird_yucatan_practical_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="weighted-abundance-density" class="level3">
<h3 class="anchored" data-anchor-id="weighted-abundance-density">1.3.3. Weighted abundance density</h3>
<p>We can also weight the density by actual counts, giving more emphasis to locations where the species was seen in higher numbers.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mx_states, <span class="at">fill =</span> <span class="st">"grey95"</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> belize, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> guatemala, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density_2d</span>(<span class="at">data =</span> species_detections,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fill =</span> <span class="fu">after_stat</span>(level), <span class="at">weight =</span> count),</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">geom =</span> <span class="st">"polygon"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">bins =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">92</span>, <span class="sc">-</span><span class="dv">86</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">22</span>)) <span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Weighted abundance density:"</span>, focal_species),</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Kernel density weighted by observation counts"</span>,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Density"</span>,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in stat_density_2d(data = species_detections, aes(x = longitude, :
Ignoring unknown aesthetics: weight</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation:
weight.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ebird_yucatan_practical_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="hexagonal-binning-for-abundance-extrapolation" class="level3">
<h3 class="anchored" data-anchor-id="hexagonal-binning-for-abundance-extrapolation">1.3.4. Hexagonal binning for abundance extrapolation</h3>
<p>Hexagonal bins provide an alternative way to visualize spatial patterns and can be used to extrapolate species abundance across the region. This approach aggregates observations into hexagonal cells, which provides a smooth representation while being computationally efficient.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hexbin map of sampling effort</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mx_states, <span class="at">fill =</span> <span class="st">"grey95"</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> belize, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> guatemala, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hex</span>(<span class="at">data =</span> checklists, </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude), </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">bins =</span> <span class="dv">30</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"magma"</span>, <span class="at">trans =</span> <span class="st">"log10"</span>) <span class="sc">+</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">92</span>, <span class="sc">-</span><span class="dv">86</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">22</span>)) <span class="sc">+</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Sampling effort: hexagonal binning"</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Number of checklists per hexagonal cell"</span>,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Checklists</span><span class="sc">\n</span><span class="st">(log scale)"</span>,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Computation failed in `stat_binhex()`.
Caused by error in `compute_group()`:
! The package "hexbin" is required for `stat_bin_hex()`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ebird_yucatan_practical_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hexbin map of species abundance</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mx_states, <span class="at">fill =</span> <span class="st">"grey95"</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> belize, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> guatemala, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hex</span>(<span class="at">data =</span> species_detections,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">bins =</span> <span class="dv">25</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>, <span class="at">name =</span> <span class="st">"Detections"</span>) <span class="sc">+</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">92</span>, <span class="sc">-</span><span class="dv">86</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">22</span>)) <span class="sc">+</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Species distribution:"</span>, focal_species),</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Hexagonal binning of detection locations"</span>,</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Computation failed in `stat_binhex()`.
Caused by error in `compute_group()`:
! The package "hexbin" is required for `stat_bin_hex()`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ebird_yucatan_practical_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hexbin map weighted by abundance (sum of counts per cell)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mx_states, <span class="at">fill =</span> <span class="st">"grey95"</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> belize, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> guatemala, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary_hex</span>(<span class="at">data =</span> species_detections,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">z =</span> count),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fun =</span> sum, <span class="at">bins =</span> <span class="dv">25</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>, <span class="at">name =</span> <span class="st">"Total</span><span class="sc">\n</span><span class="st">count"</span>) <span class="sc">+</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">92</span>, <span class="sc">-</span><span class="dv">86</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">22</span>)) <span class="sc">+</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Abundance extrapolation:"</span>, focal_species),</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Total counts aggregated in hexagonal cells"</span>,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Computation failed in `stat_summary_hex()`.
Caused by error in `compute_group()`:
! The package "hexbin" is required for `stat_summary_hex()`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ebird_yucatan_practical_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean abundance per hexagonal cell</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mx_states, <span class="at">fill =</span> <span class="st">"grey95"</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> belize, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> guatemala, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary_hex</span>(<span class="at">data =</span> species_detections,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">z =</span> count),</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fun =</span> mean, <span class="at">bins =</span> <span class="dv">25</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>, <span class="at">name =</span> <span class="st">"Mean</span><span class="sc">\n</span><span class="st">count"</span>) <span class="sc">+</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">92</span>, <span class="sc">-</span><span class="dv">86</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">22</span>)) <span class="sc">+</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Mean abundance:"</span>, focal_species),</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Average counts per hexagonal cell"</span>,</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Computation failed in `stat_summary_hex()`.
Caused by error in `compute_group()`:
! The package "hexbin" is required for `stat_summary_hex()`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ebird_yucatan_practical_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Task 1.3</strong></p>
<ol type="1">
<li>Where is sampling effort most concentrated in the Yucatan Peninsula?</li>
<li>How does the distribution of your focal species compare to overall sampling effort?</li>
<li>Choose a different species from the dataset and create its abundance density map. What does this tell you about the species’ distribution?</li>
<li>Why might it be important to account for sampling effort when interpreting species distribution patterns?</li>
<li>Compare the hexagonal binning approach to kernel density estimation. What are the advantages of each method?</li>
<li>How do the total count and mean count hexbin maps differ in their interpretation? Which is more useful for understanding species distribution?</li>
</ol>
</section>
</section>
</section>
<section id="species-trends-reporting-rates-over-time" class="level1">
<h1>2. Species trends: reporting rates over time</h1>
<p>Inspired by conservation concerns in the papers, we can examine <strong>reporting rates</strong> of two species through time in this teaching dataset.</p>
<section id="prepare-annual-reporting-data" class="level2">
<h2 class="anchored" data-anchor-id="prepare-annual-reporting-data">2.1. Prepare annual reporting data</h2>
<p>Reporting rate = proportion of complete checklists on which the species was recorded.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># total number of checklists per year</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>total_per_year <span class="ot">&lt;-</span> checklists <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year, <span class="at">name =</span> <span class="st">"n_checklists"</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># detections per species-year (presence on a checklist)</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>species_year <span class="ot">&lt;-</span> detections <span class="sc">|&gt;</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(checklist_ID, species_code) <span class="sc">|&gt;</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(checklists <span class="sc">|&gt;</span> <span class="fu">select</span>(checklist_ID, year), <span class="at">by =</span> <span class="st">"checklist_ID"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(species_code, year, <span class="at">name =</span> <span class="st">"n_checklists_with_species"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(total_per_year, <span class="at">by =</span> <span class="st">"year"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">reporting_rate =</span> n_checklists_with_species <span class="sc">/</span> n_checklists)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(species_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  species_code  year n_checklists_with_species n_checklists reporting_rate
  &lt;chr&gt;        &lt;dbl&gt;                     &lt;int&gt;        &lt;int&gt;          &lt;dbl&gt;
1 acafly        2014                        25        15788        0.00158
2 acafly        2015                        31        22124        0.00140
3 acowoo        2014                       675        15788        0.0428 
4 acowoo        2015                       887        22124        0.0401 
5 agaher1       2014                        43        15788        0.00272
6 agaher1       2015                        78        22124        0.00353</code></pre>
</div>
</div>
</section>
<section id="plot-reporting-rate-trends" class="level2">
<h2 class="anchored" data-anchor-id="plot-reporting-rate-trends">2.2. Plot reporting rate trends</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select some species of interest</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>species_year <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species_code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"yebsap"</span>,<span class="st">"plapar"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(traits <span class="sc">|&gt;</span> <span class="fu">select</span>(species_code, scientific_name), <span class="at">by =</span> <span class="st">"species_code"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> reporting_rate, <span class="at">color =</span> scientific_name)) <span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Reporting rate trends for two focal species"</span>,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Reporting rate (proportion of checklists)"</span>,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Species"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ebird_yucatan_practical_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Task 2.1</strong></p>
<ol type="1">
<li>Compare the reporting rate trends of the two species.<br>
</li>
<li>Which species appears more “secure” in the dataset? Why?</li>
<li>How might habitat loss (as in Stewart et al.) affect these trends in real data?</li>
</ol>
</section>
</section>
<section id="land-cover-comparison-community-composition" class="level1">
<h1>3. Land cover comparison: community composition</h1>
<p>We want to know whether land cover types differ in their <strong>species composition</strong>.</p>
<section id="species-by-land-cover-table" class="level2">
<h2 class="anchored" data-anchor-id="species-by-land-cover-table">3.1. Species-by-land-cover table</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># join detections to checklist land cover</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>det_with_hab <span class="ot">&lt;-</span> detections <span class="sc">|&gt;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(checklists <span class="sc">|&gt;</span> <span class="fu">select</span>(checklist_ID, land_cover), <span class="at">by =</span> <span class="st">"checklist_ID"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>species_habitat <span class="ot">&lt;-</span> det_with_hab <span class="sc">|&gt;</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(land_cover, scientific_name) <span class="sc">|&gt;</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_checklists =</span> <span class="fu">n_distinct</span>(checklist_ID),</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_count  =</span> <span class="fu">sum</span>(count), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>species_habitat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,841 × 4
   land_cover  scientific_name       n_checklists total_count
   &lt;chr&gt;       &lt;chr&gt;                        &lt;int&gt;       &lt;dbl&gt;
 1 agriculture Accipiter striatus               2           2
 2 agriculture Actitis macularius              10          35
 3 agriculture Agelaius phoeniceus              7         149
 4 agriculture Aimophila rufescens              7           8
 5 agriculture Amazilia candida                 1           4
 6 agriculture Amazilia cyanocephala            6           8
 7 agriculture Amazilia rutila                  2           4
 8 agriculture Amazilia tzacatl                 7          13
 9 agriculture Amazona albifrons                4          11
10 agriculture Amazona autumnalis              11          36
# ℹ 3,831 more rows</code></pre>
</div>
</div>
</section>
<section id="most-frequently-detected-species-per-land-cover" class="level2">
<h2 class="anchored" data-anchor-id="most-frequently-detected-species-per-land-cover">3.2. Most frequently detected species per land cover</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>species_habitat <span class="sc">|&gt;</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(land_cover) <span class="sc">|&gt;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> n_checklists, <span class="at">n =</span> <span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(land_cover, <span class="fu">desc</span>(n_checklists))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 4
# Groups:   land_cover [6]
   land_cover  scientific_name      n_checklists total_count
   &lt;chr&gt;       &lt;chr&gt;                       &lt;int&gt;       &lt;dbl&gt;
 1 agriculture Cathartes aura                 60         383
 2 agriculture Sporophila morelleti           46         270
 3 agriculture Coragyps atratus               42         521
 4 agriculture Quiscalus mexicanus            41         438
 5 agriculture Dives dives                    34         107
 6 forest      Myiozetetes similis          6400       19010
 7 forest      Dives dives                  6204       21467
 8 forest      Turdus grayi                 6060       18410
 9 forest      Melanerpes aurifrons         5998       12106
10 forest      Coragyps atratus             5804       38600
# ℹ 20 more rows</code></pre>
</div>
</div>
<p><strong>Task 3.1</strong></p>
<ol type="1">
<li>Which species dominate urban vs forest checklists?<br>
</li>
<li>Do the dominant species match your expectations for those land cover types?</li>
</ol>
</section>
</section>
<section id="functional-diversity-by-land-cover" class="level1">
<h1>4. Functional diversity by land cover</h1>
<p>Now we bring in <strong>functional traits</strong> to approximate ideas from Matthews et al.&nbsp;(functional diversity and non-random loss of traits).</p>
<p>We will:</p>
<ol type="1">
<li>Create a trait matrix for the species in our dataset.</li>
<li>Compute simple functional diversity (FD) indices for each land cover type.</li>
<li>Visualise trait structure across land cover types.</li>
</ol>
<section id="trait-matrix-for-species" class="level2">
<h2 class="anchored" data-anchor-id="trait-matrix-for-species">4.1. Trait matrix for species</h2>
<p>We will use numeric traits:</p>
<ul>
<li>body mass (g)</li>
<li>beak length culmen (mm)</li>
<li>wing length (mm)</li>
<li>beak width (mm)</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># species present in traits data</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>species_present <span class="ot">&lt;-</span> traits <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(scientific_name) <span class="sc">|&gt;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>traits_num <span class="ot">&lt;-</span> traits <span class="sc">|&gt;</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(scientific_name <span class="sc">%in%</span> species_present) <span class="sc">|&gt;</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(scientific_name) <span class="sc">|&gt;</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">"scientific_name"</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(body_mass_g, beak_length_culmen, wing_length, beak_width)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(traits_num)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                        body_mass_g beak_length_culmen wing_length beak_width
Abeillia abeillei               2.7               13.0        47.0        1.2
Accipiter bicolor             287.5               25.0       229.6        8.6
Accipiter cooperii            429.7               25.4       241.2        8.6
Accipiter striatus            130.6               18.3       181.6        7.3
Acrocephalus scirpaceus        12.3               18.2        65.3        3.2
Actitis macularius             40.4               25.7       100.4        2.7</code></pre>
</div>
</div>
</section>
<section id="species-relative-abundance-by-land-cover" class="level2">
<h2 class="anchored" data-anchor-id="species-relative-abundance-by-land-cover">4.2. Species relative abundance by land cover</h2>
<p><code>FD::dbFD()</code> expects species abundances (or presence–absence) per site. Here, we treat <strong>land cover types as sites</strong> and use <code>total_count</code> as abundance.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>abund_habitat <span class="ot">&lt;-</span> species_habitat <span class="sc">|&gt;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(scientific_name <span class="sc">%in%</span> species_present) <span class="sc">|&gt;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(scientific_name) <span class="sc">|&gt;</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(land_cover, scientific_name, total_count) <span class="sc">|&gt;</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> scientific_name, <span class="at">values_from =</span> total_count, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">"land_cover"</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>abund_habitat[, <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Abeillia abeillei Accipiter bicolor Accipiter cooperii
forest                    764                65                 61
grassland                  16                 5                 18
urban                       3                 1                 14
wetland                     0                 3                  0
other                       0                 0                  1
agriculture                 0                 0                  0
            Accipiter striatus Acrocephalus scirpaceus Actitis macularius
forest                     188                       0               2090
grassland                   48                       0               1206
urban                       37                       0               1038
wetland                      0                       1                992
other                        0                       0               1167
agriculture                  2                       0                 35
            Aegolius ridgwayi
forest                     21
grassland                   4
urban                       0
wetland                     0
other                       0
agriculture                 0</code></pre>
</div>
</div>
</section>
<section id="compute-functional-diversity-indices" class="level2">
<h2 class="anchored" data-anchor-id="compute-functional-diversity-indices">4.3. Compute functional diversity indices</h2>
<p>We will calculate:</p>
<ul>
<li>FRic – functional richness (volume of convex hull in trait space)</li>
<li>FEve – functional evenness</li>
<li>FDiv – functional divergence</li>
<li>RaoQ – Rao’s quadratic entropy</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>fd_res <span class="ot">&lt;-</span> <span class="fu">dbFD</span>(traits_num, abund_habitat, <span class="at">calc.FRic =</span> <span class="cn">TRUE</span>, <span class="at">calc.FDiv =</span> <span class="cn">TRUE</span>,</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">calc.FGR =</span> <span class="cn">FALSE</span>, <span class="at">m =</span> <span class="st">"max"</span>, <span class="at">messages =</span> <span class="cn">FALSE</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>fd_indices <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">land_cover =</span> <span class="fu">rownames</span>(abund_habitat),</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">FRic    =</span> fd_res<span class="sc">$</span>FRic,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">FEve    =</span> fd_res<span class="sc">$</span>FEve,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">FDiv    =</span> fd_res<span class="sc">$</span>FDiv,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">RaoQ    =</span> fd_res<span class="sc">$</span>RaoQ</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>fd_indices</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  land_cover   FRic   FEve  FDiv  RaoQ
  &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 forest       381. 0.0649 0.766  4.32
2 grassland    263. 0.298  0.745  7.01
3 urban        266. 0.289  0.787 10.3 
4 wetland      260. 0.374  0.797 14.7 
5 other        267. 0.377  0.788 13.2 
6 agriculture  164. 0.427  0.691  4.36</code></pre>
</div>
</div>
</section>
<section id="visualising-functional-diversity-differences" class="level2">
<h2 class="anchored" data-anchor-id="visualising-functional-diversity-differences">4.4. Visualising functional diversity differences</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fd_indices_long <span class="ot">&lt;-</span> fd_indices <span class="sc">|&gt;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>land_cover, <span class="at">names_to =</span> <span class="st">"index"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fd_indices_long, <span class="fu">aes</span>(<span class="at">x =</span> land_cover, <span class="at">y =</span> value, <span class="at">fill =</span> land_cover)) <span class="sc">+</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> index, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Functional diversity of bird communities by land cover"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ebird_yucatan_practical_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Task 4.1</strong></p>
<ol type="1">
<li>Which land cover type has the highest functional richness (FRic)?<br>
</li>
<li>Does any land cover show low FRic but relatively high FEve or FDiv? How might that happen?<br>
</li>
<li>Relate your findings to the idea that anthropogenic extinctions can be <strong>trait-biased</strong> and reduce specific ecological functions (Matthews et al.).</li>
</ol>
</section>
</section>
<section id="trait-distributions-in-different-land-cover-types" class="level1">
<h1>5. Trait distributions in different land cover types</h1>
<p>We can also look directly at traits of species that dominate each land cover type.</p>
<section id="trait-distributions-weighted-by-abundance" class="level2">
<h2 class="anchored" data-anchor-id="trait-distributions-weighted-by-abundance">5.1. Trait distributions weighted by abundance</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>traits_long <span class="ot">&lt;-</span> det_with_hab <span class="sc">|&gt;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(land_cover, scientific_name) <span class="sc">|&gt;</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_count =</span> <span class="fu">sum</span>(count), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(traits, <span class="at">by =</span> <span class="st">"scientific_name"</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(traits_long, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">weight =</span> total_count, <span class="at">fill =</span> land_cover)) <span class="sc">+</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">bins =</span> <span class="dv">20</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Body mass distribution by land cover (abundance-weighted)"</span>,</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Body mass (g)"</span>, <span class="at">y =</span> <span class="st">"Weighted frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 527 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ebird_yucatan_practical_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Task 5.1</strong></p>
<ol type="1">
<li>Are large-bodied species more frequent in any particular land cover type?<br>
</li>
<li>How would selective loss of large-bodied species influence ecosystem functioning?</li>
</ol>
<p>A similar plot can be made for wing or beak length. Try modifying the code above.</p>
</section>
</section>
<section id="optional-extension-pca-of-traits" class="level1">
<h1>6. Optional extension: PCA of traits</h1>
<p>For a more visual representation of the trait space, we can perform a simple PCA.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>traits_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(traits_num)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(traits_scaled)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>pca_scores <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(pca<span class="sc">$</span>x, <span class="at">rownames =</span> <span class="st">"scientific_name"</span>) <span class="sc">|&gt;</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(traits <span class="sc">|&gt;</span> <span class="fu">select</span>(scientific_name, trophic_niche), <span class="at">by =</span> <span class="st">"scientific_name"</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pca_scores, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">label =</span> scientific_name,</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">color =</span> trophic_niche)) <span class="sc">+</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">max.overlaps =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Trait space of Yucatan Peninsula birds (teaching dataset)"</span>,</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"PC1/PC2 of body mass, beak length, wing length, beak width"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 714 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ebird_yucatan_practical_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Task 6.1 (optional)</strong></p>
<ul>
<li>Identify which traits mainly drive PC1 and PC2 (use <code>summary(pca)</code>).</li>
<li>Discuss where species with different trophic niches lie in this space.</li>
</ul>
</section>
<section id="wrap-up-questions" class="level1">
<h1>7. Wrap-up questions</h1>
<ol type="1">
<li>How do species richness and functional diversity vary among land cover types in this dataset?<br>
</li>
<li>If habitat loss continues in the Yucatan Peninsula, which land cover types (and associated communities) do you think are at greatest risk?<br>
</li>
<li>How could you integrate <strong>real eBird data</strong> and <strong>more detailed trait datasets</strong> (e.g.&nbsp;AVONET) to test similar questions at larger scales?<br>
</li>
<li>How do your findings conceptually link to the key messages of Stewart et al.&nbsp;and Matthews et al.?</li>
</ol>
<p>You have completed the core practical. Feel free to extend the analyses, for example by:</p>
<ul>
<li>focusing on a single species of conservation concern;</li>
<li>investigating latitudinal gradients;</li>
<li>or comparing different regions within the Yucatan Peninsula.</li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>